# AI能力判定ロジック仕様書

## 概要

生徒の探究活動の記録（投稿内容）を分析し、該当する非認知能力をAIで自動判定し、5段階ルーブリックでレベル評価する機能の仕様書です。

---

## 1. 判定対象の7つの非認知能力

| コード | 能力名 | 概要 |
|--------|--------|------|
| `problem_setting` | 課題設定力 | 適切な課題を設定し、明確な問いを立てる力 |
| `information_gathering` | 情報収集力 | 必要な情報を効率的に収集し、整理する力 |
| `involvement` | 巻き込む力 | 他者を巻き込み、協力を得る力 |
| `communication` | 対話する力 | 他者と建設的な対話を行い、理解を深める力 |
| `humility` | 謙虚である力 | 他者の意見を受け入れ、学び続ける姿勢 |
| `execution` | 実行する力 | 計画を実行に移し、行動する力 |
| `completion` | 完遂する力 | 最後までやり遂げる力、継続する力 |

---

## 2. 5段階ルーブリック評価

### 2.1 レベル概要

| レベル | 名称 | 意味 |
|--------|------|------|
| Lv1 | 初歩的 | その能力の発揮が弱い、または不十分 |
| Lv2 | 発展途上 | 基本的な行動は見られるが、深さや継続性が不足 |
| Lv3 | 標準的 | その能力が適切に発揮されている |
| Lv4 | 発展的 | 自発的・計画的に能力を発揮している |
| Lv5 | 卓越 | 周囲への波及効果や継続的な成長が見られる |

### 2.2 各能力のルーブリック詳細

#### 課題設定力（problem_setting）

| レベル | 基準 |
|--------|------|
| Lv1 | テーマが「好き・面白そう」で止まり、問いになっていない |
| Lv2 | 問いはあるが広すぎる／曖昧で、調べても答えが定まらない |
| Lv3 | 「何を」「なぜ」「どう確かめるか」が揃った問いを置ける |
| Lv4 | サブクエスチョンや仮説を立て、検証の方法を設計できる |
| Lv5 | 調査の途中で問いを磨き直し、より本質的な問いへ再設計できる |

#### 情報収集力（information_gathering）

| レベル | 基準 |
|--------|------|
| Lv1 | 何を調べるべきかが曖昧で、調べずに思い込みで進める |
| Lv2 | 検索で情報を集めるが、単発で終わりやすい |
| Lv3 | 問いに必要なキーワードを考えて調べ、メモに残せる |
| Lv4 | 情報の信頼性を確認しながら収集できる |
| Lv5 | 一次情報を設計し、情報の質を自分で高められる |

#### 巻き込む力（involvement）

| レベル | 基準 |
|--------|------|
| Lv1 | 困っても相談せず、抱え込んで停滞する |
| Lv2 | 近い友人や先生には相談できるが、目的や依頼が曖昧 |
| Lv3 | 探究を進めるために、必要な相手に相談・依頼ができる |
| Lv4 | インタビュー先・協力者を自分で開拓し、関係を継続できる |
| Lv5 | 人と人をつなぎ、探究が広がる場をつくれる |

#### 対話する力（communication）

| レベル | 基準 |
|--------|------|
| Lv1 | 相手の話を十分に聞けず、必要な情報が取れない |
| Lv2 | 質問はできるが、深掘りや要約が弱い |
| Lv3 | オープンクエスチョンで聞き、要点を要約して確認できる |
| Lv4 | インタビュー設計をして、本質に近づく対話ができる |
| Lv5 | 対話を通じて相手の気づきも生み、協力関係を強められる |

#### 謙虚である力（humility）

| レベル | 基準 |
|--------|------|
| Lv1 | 指摘を拒んだり、言い訳が先に出て改善が起きない |
| Lv2 | 指摘は聞くが、行動や成果物に反映されにくい |
| Lv3 | 指摘を受け止め、必要な修正を行える |
| Lv4 | 自分から批評を取りに行き、反証・弱点を歓迎して精度を上げられる |
| Lv5 | 学び合いの文化をつくり、周囲の探究姿勢まで良くしていける |

#### 実行する力（execution）

| レベル | 基準 |
|--------|------|
| Lv1 | 計画やアイデアで止まり、検証行動に移れない |
| Lv2 | 一度は動くが、記録や振り返りが弱く、学びが積み上がらない |
| Lv3 | 小さな検証を回し、結果を記録できる |
| Lv4 | 検証計画を立て、継続的に改善できる |
| Lv5 | 周囲も巻き込みながら検証サイクルを高速で回せる |

#### 完遂する力（completion）

| レベル | 基準 |
|--------|------|
| Lv1 | 途中で止まり、成果物が完成しない |
| Lv2 | 最低限は形にするが、根拠・構成・検証が弱い |
| Lv3 | 期限までに成果物を完成できる |
| Lv4 | 根拠の提示が明確で、第三者が理解できる品質になっている |
| Lv5 | 発表や共有によって周囲に影響を与え、探究が継続・発展する |

---

## 3. 判定ロジック

### 3.1 入力データ

```json
{
  "problem": "課題・問い（任意）",
  "content": "やってみたこと（必須）"
}
```

### 3.2 出力データ

```json
{
  "matched_abilities": [
    {
      "code": "ability_code",
      "name": "能力名",
      "level": 3,
      "level_reason": "ルーブリックLv3「〜」に該当するため",
      "reason": "該当理由（具体的な活動内容の引用）"
    }
  ],
  "analysis_summary": "分析サマリー（能力名とレベルを含む）"
}
```

### 3.3 判定基準

1. **能力の該当判定**: 活動内容に明確に関連する能力のみを選択
2. **レベル判定**: ルーブリックを参照し、活動の深さ・質に応じて1〜5のレベルを決定
3. **理由の明示**:
   - `level_reason`: ルーブリックのどの基準に該当するか
   - `reason`: 具体的な活動内容の引用

---

## 4. Few-shot判定例

### 例1: 情報収集力（Lv3）

**入力:**
- 課題: 地域の高齢化問題について調べる
- やってみたこと: 図書館で高齢化に関する本を3冊借りて読み、重要なポイントをノートにまとめた。

**出力:**
```json
{
  "matched_abilities": [
    {
      "code": "information_gathering",
      "name": "情報収集力",
      "level": 3,
      "level_reason": "問いに必要なキーワードを考えて調べ、メモに残しているためLv3相当",
      "reason": "図書館で本を借りて調べ、ノートにまとめるという情報収集と整理の行動が明確に見られる"
    }
  ],
  "analysis_summary": "文献調査による情報収集力(Lv3)の発揮が見られる活動です。"
}
```

### 例2: 複数能力の判定

**入力:**
- 課題: 環境問題についての探究
- やってみたこと: NPOの方にアポを取り、オンラインでインタビューを実施した。質問リストを事前に作成し、話を聞きながらメモを取った。インタビュー後、チームで内容を共有した。

**出力:**
```json
{
  "matched_abilities": [
    {
      "code": "involvement",
      "name": "巻き込む力",
      "level": 4,
      "level_reason": "インタビュー先を自分で開拓しているためLv4相当",
      "reason": "外部のNPOにアポを取り、協力を得てインタビューを実施した"
    },
    {
      "code": "communication",
      "name": "対話する力",
      "level": 4,
      "level_reason": "インタビュー設計をして対話しているためLv4相当",
      "reason": "質問リストを準備し、インタビューで相手から情報を引き出した"
    },
    {
      "code": "execution",
      "name": "実行する力",
      "level": 3,
      "level_reason": "小さな検証を回し、結果を記録しているためLv3相当",
      "reason": "計画を立てて実際にインタビューを実行した"
    }
  ],
  "analysis_summary": "外部協力者との対話を通じた探究活動で、巻き込む力(Lv4)・対話する力(Lv4)・実行する力(Lv3)が発揮されています。"
}
```

### 例3: 該当なし

**入力:**
- 課題: プログラミング学習
- やってみたこと: 今日は疲れていたので何もしなかった。

**出力:**
```json
{
  "matched_abilities": [],
  "analysis_summary": "具体的な探究活動が記載されていないため、該当する能力を判定できません。"
}
```

---

## 5. API仕様

### エンドポイント

```
POST /ability-analysis/analyze
```

### リクエスト

```json
{
  "problem": "課題・問い（任意）",
  "content": "やってみたこと（必須）"
}
```

### レスポンス

```json
{
  "matched_abilities": [
    {
      "code": "string",
      "name": "string",
      "level": 1-5,
      "level_reason": "string",
      "reason": "string"
    }
  ],
  "analysis_summary": "string",
  "error": "string (optional)"
}
```

### 能力一覧取得

```
GET /ability-analysis/abilities
```

---

## 6. 技術仕様

- **モデル**: OpenAI GPT-4o-mini（設定変更可能）
- **Temperature**: 0.2（一貫性を重視）
- **Response Format**: JSON Object
- **レベル範囲**: 1〜5（範囲外は自動補正）
- **ソート**: レベルの高い順

---

## 7. UI表示

### レベル表示（色分け）

| レベル | 色 | 意味 |
|--------|-----|------|
| Lv1 | グレー | 初歩的 |
| Lv2 | 黄色 | 発展途上 |
| Lv3 | 青 | 標準的 |
| Lv4 | 緑 | 発展的 |
| Lv5 | 紫 | 卓越 |

### レベル表示の仕様

- 5つの丸いアイコン（1〜5）を横並びで表示
- **該当レベルのみ**色付き（他はグレー）
- 例：Lv3の場合 → 1,2はグレー、**3のみ青**、4,5はグレー

### 表示構成（情報の優先順位）

```
┌─────────────────────────────────────────────┐
│ [能力名バッジ]              [1][2][③][4][5] [標準的] │  ← ヘッダー
├─────────────────────────────────────────────┤
│ 該当理由（メイン情報）                              │  ← 上部に配置
│ 具体的な活動内容を引用した説明                       │
├─────────────────────────────────────────────┤
│ │ Lv3の根拠: ルーブリック参照箇所               │  ← 下部に配置（補足情報）
└─────────────────────────────────────────────┘
```

### 表示要素の詳細

1. **能力名**: カラーバッジで表示（能力ごとに色分け）
2. **5段階レベル**: 丸い数字アイコンで視覚化（**該当レベルのみ色付き**）
3. **レベルラベル**: レベル名をバッジで表示（「標準的」など）
4. **該当理由**（上部・メイン）: 具体的な活動内容の引用、目立つフォント
5. **レベル判定の根拠**（下部・補足）: ルーブリック参照箇所、小さめフォント、左線付き

---

## 8. 今後の拡張案

1. **経時変化分析**: 生徒の能力成長を時系列で追跡
2. **フィードバック生成**: レベルアップのための具体的アドバイス
3. **バッチ処理**: 複数投稿の一括分析
4. **カスタムルーブリック**: 学校独自の評価基準への対応
5. **教師レビュー機能**: AI判定結果の教師による確認・修正
