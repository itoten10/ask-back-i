# ASK セキュリティ要件 - 初心者向け解説

> このドキュメントは「ASK_セキュリティ要件.md」の内容を、ITやセキュリティに詳しくない方でも理解できるように解説したものです。

---

## はじめに - セキュリティって何？

**セキュリティ**とは、簡単に言うと「大切な情報を守る仕組み」のことです。

ASKアプリでは、以下のような大切な情報を扱っています：
- 生徒や先生の名前、メールアドレス
- ログインパスワード
- 探究学習の記録や評価

これらが漏れたり、悪用されたりしないように守る必要があります。

---

## 現在の状況 - 何ができていて、何ができていないか

### すでにできていること（安心ポイント）

| できていること | 簡単な説明 | 家で例えると |
|--------------|-----------|-------------|
| **パスワードの安全な保存** | パスワードを暗号化して保存 | 金庫に鍵をかけている |
| **2段階認証** | パスワード＋スマホアプリで確認 | 鍵＋顔認証のダブルロック |
| **Google認証** | Googleアカウントでログイン | 信頼できる警備会社に任せる |
| **通信の暗号化** | データを暗号化して送受信 | 手紙を封筒に入れて送る |
| **アクセス制限** | 生徒/教師/管理者で見える範囲を制限 | 部屋ごとに鍵が違う |
| **ログ記録** | 誰がいつログインしたか記録 | 防犯カメラの録画 |

### まだできていないこと（改善が必要）

| できていないこと | リスク | 家で例えると |
|----------------|--------|-------------|
| **WAF（防御壁）** | 悪意ある攻撃を防げない | 塀がない家 |
| **DDoS対策** | 大量アクセスで停止する | 玄関に人が殺到して入れなくなる |
| **ネットワーク分離** | 内部で情報が漏れやすい | 部屋の間に壁がない |
| **秘密情報の管理** | 設定ファイルに直接書いてある | 鍵を玄関マットの下に置いている |

---

## 実装の難易度 - どれくらい大変？

### 簡単にできるもの（コード変更や設定だけ）

| 対策 | 作業内容 | 所要時間 | 費用 |
|------|---------|---------|------|
| **セキュリティヘッダー追加** | コードに数行追加するだけ | 1時間 | 無料 |
| **2段階認証の暗号化強化** | 設定ファイルを変更するだけ | 30分 | 無料 |
| **バックアップ暗号化** | Azureの設定画面で変更 | 1時間 | 無料〜少額 |
| **DDoS対策** | Azureの設定画面で有効化 | 1時間 | 無料〜 |

### 少し手間がかかるもの（新しいサービスを追加）

| 対策 | 作業内容 | 所要時間 | 費用 |
|------|---------|---------|------|
| **Key Vault（秘密管理）** | Azureサービス追加＋コード修正 | 1-2日 | 約¥1,000/月 |
| **Redis（分散処理）** | Azureサービス追加＋コード修正 | 2-3日 | 約¥2,500/月 |
| **WAF（防御壁）** | Azure Front Door設定 | 1-2日 | 約¥15,000/月 |
| **ログ監視** | Azure Monitor設定 | 1日 | 約¥2,000/月 |

### 大変なもの（構成の大幅変更が必要）

| 対策 | 作業内容 | 所要時間 | 費用 |
|------|---------|---------|------|
| **VNet統合（ネットワーク分離）** | Azure全体の構成変更 | 1-2週間 | 約¥5,000/月 |
| **監査ログDB分離** | データベース設計変更 | 1週間 | 約¥3,000/月 |
| **高度なID管理** | 認証システム全体の見直し | 2-4週間 | 約¥5,000/月 |

---

## 費用の計算方法

### Azureの料金の仕組み

Azureの料金は「使った分だけ払う」仕組みです。主に以下の要素で決まります：

```
月額費用 = 基本料金 + 使用量に応じた料金

例：
- App Service（サーバー）: 固定 約¥15,000/月
- MySQL（データベース）: 固定 約¥2,500/月 + ストレージ使用量
- Front Door（防御壁）: 固定 約¥5,000/月 + アクセス数に応じた料金
```

### 費用を調べる方法

1. **Azure Pricing Calculator**（見積もりツール）
   - https://azure.microsoft.com/pricing/calculator/
   - 日本語で使える、無料のWebツール
   - サービスを選んで設定すると、月額費用が分かる

2. **費用を安くするコツ**
   - **予約割引**: 1年契約で約20%、3年契約で約40%安くなる
   - **開発環境は安いプラン**: テスト用は無料〜格安プランを使う
   - **使わない時は停止**: 夜間や休日は停止できるものもある

### 学校向けの現実的な費用

| 学校規模 | 推奨プラン | 月額目安 | 年額目安 |
|---------|-----------|---------|---------|
| 小規模（〜300人） | 基本セキュリティ | ¥5,000〜10,000 | ¥60,000〜120,000 |
| 中規模（300〜1000人） | 標準セキュリティ | ¥20,000〜40,000 | ¥240,000〜480,000 |
| 大規模（1000人〜） | 高度セキュリティ | ¥80,000〜150,000 | ¥960,000〜1,800,000 |

---

## よくある攻撃とその対策

### 攻撃の種類（簡単な説明）

| 攻撃の名前 | 何をされるか | 例え話 |
|-----------|-------------|--------|
| **ブルートフォース** | パスワードを何度も試される | 泥棒が鍵を何千通りも試す |
| **SQLインジェクション** | 不正なコマンドでデータを盗む | 偽の注文書で倉庫から商品を持ち出す |
| **XSS** | 偽のスクリプトを埋め込まれる | 偽の案内板で利用者を騙す |
| **DDoS** | 大量アクセスでサービスを止める | 店に大勢が押しかけて営業妨害 |
| **セッションハイジャック** | ログイン状態を乗っ取られる | 入場証を盗んで別人になりすます |

### ASKアプリの現状と対策

| 攻撃 | 現在の防御力 | 追加で必要なこと |
|------|-------------|-----------------|
| ブルートフォース | △ 一部対応 | Redis導入で強化 |
| SQLインジェクション | ○ 基本対応済 | WAF導入で強化 |
| XSS | ○ React自動対応 | WAF、CSP追加で強化 |
| DDoS | × 未対応 | Azure Front Door導入 |
| セッションハイジャック | ○ 対応済 | IP検証追加で強化 |

---

## 実装の優先順位

### 今すぐやるべきこと（無料でできる）

1. **セキュリティヘッダーの追加**
   - 作業: コードに数行追加
   - 効果: XSSなどの攻撃を防ぐ
   - 時間: 1時間

2. **2段階認証の暗号化を有効化**
   - 作業: 設定ファイルを1行変更
   - 効果: データベースが漏れても2段階認証は守られる
   - 時間: 30分

3. **設定ファイルの確認**
   - 作業: .envファイルがGitに含まれていないか確認
   - 効果: パスワードなどの漏洩防止
   - 時間: 10分

### 1-2ヶ月以内にやるべきこと

1. **Azure Key Vault導入**（約¥1,000/月）
   - パスワードなどを安全に管理

2. **Redis Cache導入**（約¥2,500/月）
   - ログイン試行の制限を強化

### 3-6ヶ月以内に検討すべきこと

1. **Azure Front Door + WAF**（約¥15,000/月）
   - 攻撃からの防御壁

2. **監視・アラート設定**（約¥2,000/月）
   - 異常を検知して通知

---

## もし情報漏洩が起きたら？

### やるべきこと（法律で決まっている）

1. **すぐに対応**
   - サービスの一時停止（必要に応じて）
   - 原因の調査開始

2. **3〜5日以内に報告**
   - 個人情報保護委員会への報告（義務）
   - 該当する生徒・保護者への通知

3. **記録の保存**
   - 何が起きたか、どう対応したかを5年間保存

### 情報漏洩の代償

> **セキュリティ対策にお金をかけるのは「もったいない」と感じるかもしれません。**
> **でも、漏洩が起きた場合のコストはもっと大きいです。**

| 項目 | 費用の目安 |
|------|-----------|
| 原因調査・対応費用 | 数百万円〜数千万円 |
| 被害者への対応（お詫び等） | 1人数千円〜数万円 × 人数 |
| 信頼の失墜 | 計り知れない |
| 法的責任（罰則・賠償） | ケースによる |

**月数千円〜数万円のセキュリティ投資は「保険」と考えましょう。**

---

## 用語集（初心者向け）

| 用語 | 読み方 | 意味 |
|------|--------|------|
| **WAF** | ワフ | Webアプリを攻撃から守る壁 |
| **DDoS** | ディードス | 大量アクセスでサービスを止める攻撃 |
| **VNet** | ブイネット | Azureの中で作る仮想ネットワーク |
| **暗号化** | あんごうか | 情報を読めない形に変換すること |
| **トークン** | トークン | ログイン済みを証明するデジタルな証明書 |
| **TOTP** | ティーオーティーピー | 30秒ごとに変わる認証コード（Google Authenticatorなど） |
| **RBAC** | アールバック | 役割ごとにできることを制限する仕組み |
| **JWT** | ジェイダブリューティー | ログイン情報を安全にやり取りする仕組み |

---

## まとめ

### 現在のASKアプリのセキュリティ

- **基本的な認証・暗号化**: 実装済み
- **攻撃からの防御**: 一部不足
- **高度なセキュリティ**: 未実装

### すぐにできる改善（無料）

1. セキュリティヘッダー追加
2. 2段階認証の暗号化有効化
3. 設定ファイルの確認

### 費用をかけて改善すべきこと

| 優先度 | 対策 | 月額 |
|--------|------|------|
| 高 | Key Vault + Redis | 約¥3,500 |
| 中 | Front Door + WAF | 約¥15,000 |
| 低 | VNet統合 | 約¥5,000 |

---

**質問があれば、お気軽にどうぞ！**

---

*このドキュメントは「ASK_セキュリティ要件.md」v1.1 の初心者向け解説版です。*
*作成日: 2025年12月17日*
